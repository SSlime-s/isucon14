
# 19.8s user time, 60ms system time, 33.45M rss, 39.64M vsz
# Current date: Sun Dec  8 07:29:28 2024
# Hostname: ip-192-168-0-11
# Files: /var/log/mysql/mysql-slow.log
# Overall: 262.39k total, 150 unique, 156.84 QPS, 0.24x concurrency ______
# Time range: 2024-12-08T07:01:34 to 2024-12-08T07:29:27
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           400s     1us   434ms     2ms    11ms     4ms   152us
# Lock time          493ms       0    23ms     1us     1us   100us     1us
# Rows sent        237.23k       0  20.71k    0.93    0.99   40.90    0.99
# Rows examine       5.39M       0  41.42k   21.53    4.96  202.81    0.99
# Query size        25.55M       6 1011.33k  102.10  136.99   3.06k   97.36

# Profile
# Rank Query ID                            Response time  Calls R/Call V/M
# ==== =================================== ============== ===== ====== ===
#    1 0xFFFCA4D67EA0A788813031B8BBC3B329  298.8616 74.8% 28258 0.0106  0.00 COMMIT
#    2 0x172F25C01059578EA9ADF775DD97B517   17.3389  4.3%   374 0.0464  0.02 SELECT ride_statuses rides ride_statuses
#    3 0xD6AD8A431BE7CA447BE67E7F25C2D64A   17.1472  4.3% 22196 0.0008  0.00 SELECT chair_locations
#    4 0xDCA6B16A0FC65C799EB401CBD984EACF    7.3122  1.8% 25573 0.0003  0.00 SELECT ride_statuses
#    5 0x49D4717E21912CD8B13961B8248A27CF    6.9143  1.7% 25235 0.0003  0.01 SELECT chairs
#    6 0xD2D38076E399D482E9094817365408E9    6.7461  1.7% 22196 0.0003  0.00 INSERT chair_locations
#    7 0xD8DAD8AC6EDE2238F17AC39B0009258F    6.6649  1.7% 24808 0.0003  0.00 SELECT rides
#    8 0xE4607CFD429571DE7B78092E46EBE189    6.6151  1.7% 22128 0.0003  0.00 INSERT UPDATE chair_total_distances
#    9 0xE13EB9FE8E585FDE0A4C67FEB1D9D015    4.7820  1.2%  2432 0.0020  0.00 SELECT rides
#   10 0xDF3E6335E6C2FD1DB8C12FD4E3FB9DA3    4.6090  1.2% 22196 0.0002  0.00 SELECT chair_locations
#   11 0xA3B0C1486434871B20F519E77C3FD9E6    2.8819  0.7%  3135 0.0009  0.00 SELECT coupons
# MISC 0xMISC                               19.7630  4.9% 63859 0.0003   0.0 <139 ITEMS>

# Query 1: 434.74 QPS, 4.60x concurrency, ID 0xFFFCA4D67EA0A788813031B8BBC3B329 at byte 68680692
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:57
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         10   28258
# Exec time     74    299s    18us    43ms    11ms    16ms     5ms    11ms
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 165.57k       6       6       6       6       0       6
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ########
# 100us  #
#   1ms  #################
#  10ms  ################################################################
# 100ms
#    1s
#  10s+
COMMIT\G

# Query 2: 6.23 QPS, 0.29x concurrency, ID 0x172F25C01059578EA9ADF775DD97B517 at byte 72173036
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     374
# Exec time      4     17s     1ms   146ms    46ms   100ms    28ms    40ms
# Lock time      0   631us     1us    53us     1us     1us     2us     1us
# Rows sent     10  26.01k       0     194   71.21  174.84   50.75   44.60
# Rows examine   6 372.82k      84   2.04k 1020.78   1.96k  812.21  793.42
# Query size     1 483.88k     920   2.30k   1.29k   2.16k  439.35 1012.63
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ##
#  10ms  ################################################################
# 100ms  #####
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'ride_statuses'\G
#    SHOW CREATE TABLE `isuride`.`ride_statuses`\G
#    SHOW TABLE STATUS FROM `isuride` LIKE 'rides'\G
#    SHOW CREATE TABLE `isuride`.`rides`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT r.chair_id AS chair_id, rs.status AS status FROM ride_statuses rs LEFT JOIN rides r ON rs.ride_id = r.id INNER JOIN (SELECT ride_id, MAX(created_at) AS max_created_at FROM ride_statuses GROUP BY ride_id) latest_rs ON rs.ride_id = latest_rs.ride_id AND rs.created_at = latest_rs.max_created_at WHERE r.chair_id IN ('01JEJJNS5SKJ6023F7XE6Q2FYB', '01JEJJNS63XE2ZDSKTCTKQDAMF', '01JEJJNS6CXPRR04ENKA4W3542', '01JEJJNS6PNRVK2CYDC8ZWPR4Y', '01JEJJNS7QKSBZZWNZEQK466AE', '01JEJJNS828NQ33FV8STC82EK4', '01JEJJNS8B1SKE6P4NB4PK57BQ', '01JEJJNS8N6NWRQTET2YSWJTDB', '01JEJJNS9MDXWWRY5G7TV44XBH', '01JEJJNS9Y3TS1D5D7KHSVEFTC', '01JEJJNSA79W8G7SR901JPYVRY', '01JEJJNSAHZ18SATMAY55Q3DM7', '01JEJJNSBT7VSFJVWR564WVHN7', '01JEJJNSC37WJR8VH7986T9PMX', '01JEJJNSCD116VNQ6928885GNY', '01JEJJNSCPS1KAWAVAGNMPB2BZ', '01JEJJNSDRHY6TZMT0WA9JX408', '01JEJJNSE2Y6M808NSKYTYY676', '01JEJJNSECABB777NA4E4MCMQH', '01JEJJNSENMEDFMETM3Y2PJBTV'/*... omitted 44 items ...*/)\G

# Query 3: 369.93 QPS, 0.29x concurrency, ID 0xD6AD8A431BE7CA447BE67E7F25C2D64A at byte 70064701
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   22196
# Exec time      4     17s   114us    21ms   772us     3ms     1ms   348us
# Lock time      6    34ms       0     2ms     1us     1us    20us     1us
# Rows sent      9  21.61k       0       1    1.00    0.99    0.05    0.99
# Rows examine   0  21.61k       0       1    1.00    0.99    0.05    0.99
# Query size     8   2.29M     108     108     108     108       0     108
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  #################
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_locations'\G
#    SHOW CREATE TABLE `isuride`.`chair_locations`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM chair_locations WHERE chair_id = '01JEJJNS9MDXWWRY5G7TV44XBH' ORDER BY created_at DESC LIMIT 1\G

# Query 4: 393.43 QPS, 0.11x concurrency, ID 0xDCA6B16A0FC65C799EB401CBD984EACF at byte 31047836
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:57
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   25573
# Exec time      1      7s   104us     9ms   285us   839us   299us   167us
# Lock time      7    39ms       0     1ms     1us     1us    18us     1us
# Rows sent     10  24.97k       1       1       1       1       0       1
# Rows examine   0  24.98k       1       3    1.00    0.99    0.02    0.99
# Query size    10   2.68M     110     110     110     110       0     110
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ##
#  10ms
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'ride_statuses'\G
#    SHOW CREATE TABLE `isuride`.`ride_statuses`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT status FROM ride_statuses WHERE ride_id = '01JEJJPBN1NPWTWXS9NVE4B6WZ' ORDER BY created_at DESC LIMIT 1\G

# Query 5: 388.23 QPS, 0.11x concurrency, ID 0x49D4717E21912CD8B13961B8248A27CF at byte 4324350
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:57
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   25235
# Exec time      1      7s    92us    95ms   273us   761us     2ms   138us
# Lock time     10    50ms       0     2ms     1us     1us    22us     1us
# Rows sent     10  24.64k       1       1       1       1       0       1
# Rows examine   0  24.64k       1       1       1       1       0       1
# Query size    10   2.60M     108     108     108     108       0     108
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ##
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chairs'\G
#    SHOW CREATE TABLE `isuride`.`chairs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM chairs WHERE access_token = 'c3b7c7c422f1b0e824a162965ebfae9f6d032a8ca5fb15d16a8391bacfac8943'\G

# Query 6: 369.93 QPS, 0.11x concurrency, ID 0xD2D38076E399D482E9094817365408E9 at byte 41738951
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   22196
# Exec time      1      7s    80us    14ms   303us     1ms   595us   125us
# Lock time      6    31ms       0     2ms     1us     1us    18us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    11   2.97M     137     141  140.27  136.99       0  136.99
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  ####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_locations'\G
#    SHOW CREATE TABLE `isuride`.`chair_locations`\G
INSERT INTO chair_locations (id, chair_id, latitude, longitude) VALUES ('01JEJJPTH6CM7ZNBY0K2XTY8FV', '01JEJJNS8B1SKE6P4NB4PK57BQ', 23, -30)\G

# Query 7: 381.66 QPS, 0.10x concurrency, ID 0xD8DAD8AC6EDE2238F17AC39B0009258F at byte 77870928
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:57
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   24808
# Exec time      1      7s    96us     9ms   268us   799us   292us   152us
# Lock time      7    39ms       0   887us     1us     1us    16us     1us
# Rows sent     10  23.78k       0       1    0.98    0.99    0.13    0.99
# Rows examine   0  23.78k       0       1    0.98    0.99    0.13    0.99
# Query size     9   2.32M      98      98      98      98       0      98
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ##
#  10ms
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'rides'\G
#    SHOW CREATE TABLE `isuride`.`rides`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM rides WHERE chair_id = '01JEJJPGQRTWJVR7PTW8A7T80G' ORDER BY updated_at DESC LIMIT 1\G

# Query 8: 375.05 QPS, 0.11x concurrency, ID 0xE4607CFD429571DE7B78092E46EBE189 at byte 70444814
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:53 to 2024-12-08T07:28:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   22128
# Exec time      1      7s    90us    14ms   298us     1ms   409us   138us
# Lock time      7    36ms       0     2ms     1us     1us    22us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    11   3.02M     143     143     143     143       0     143
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_total_distances'\G
#    SHOW CREATE TABLE `isuride`.`chair_total_distances`\G
INSERT INTO chair_total_distances (chair_id, distance) VALUES ('01JEJJPJG47CJE7451EPWSXJGT', 5) ON DUPLICATE KEY UPDATE distance = distance + 5\G

# Query 9: 37.42 QPS, 0.07x concurrency, ID 0xE13EB9FE8E585FDE0A4C67FEB1D9D015 at byte 75214006
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:57
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2432
# Exec time      1      5s   506us    14ms     2ms     5ms     2ms     1ms
# Lock time      0     4ms       0   631us     1us     1us    14us     1us
# Rows sent      1   2.38k       1       1       1       1       0       1
# Rows examine  37   2.00M     753     951  862.19  918.49   57.66  833.10
# Query size     0 230.38k      97      97      97      97       0      97
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #########################
#   1ms  ################################################################
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'rides'\G
#    SHOW CREATE TABLE `isuride`.`rides`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM rides WHERE user_id = '01JEJJQJ5ZA9G07WNWGVSZ6RFE' ORDER BY created_at DESC LIMIT 1\G

# Query 10: 369.93 QPS, 0.08x concurrency, ID 0xDF3E6335E6C2FD1DB8C12FD4E3FB9DA3 at byte 70031715
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   22196
# Exec time      1      5s    56us    15ms   207us   626us   460us    98us
# Lock time      6    33ms       0     1ms     1us     1us    17us     1us
# Rows sent      9  21.68k       1       1       1       1       0       1
# Rows examine   0  21.68k       1       1       1       1       0       1
# Query size     5   1.46M      69      69      69      69       0      69
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##########################################################
# 100us  ################################################################
#   1ms  ##
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_locations'\G
#    SHOW CREATE TABLE `isuride`.`chair_locations`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM chair_locations WHERE id = '01JEJJQFDEDQHK78FCGRT5A793'\G

# Query 11: 48.23 QPS, 0.04x concurrency, ID 0xA3B0C1486434871B20F519E77C3FD9E6 at byte 75187731
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:27:52 to 2024-12-08T07:28:57
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    3135
# Exec time      0      3s   270us     9ms   919us     3ms   796us   568us
# Lock time      1     6ms       0   933us     1us     1us    22us     1us
# Rows sent      0   2.04k       0       1    0.67    0.99    0.47    0.99
# Rows examine  33   1.79M     528     655  599.36  652.75   38.39  563.87
# Query size     0 202.06k      66      66      66      66       0      66
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ########################
#  10ms
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'coupons'\G
#    SHOW CREATE TABLE `isuride`.`coupons`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM coupons WHERE used_by = '01JEJJQD8QKNNZ9J7C1W70C0SQ'\G
