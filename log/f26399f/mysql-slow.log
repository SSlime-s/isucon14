
# 21.2s user time, 50ms system time, 33.34M rss, 39.50M vsz
# Current date: Sun Dec  8 07:45:03 2024
# Hostname: ip-192-168-0-11
# Files: /var/log/mysql/mysql-slow.log
# Overall: 280.28k total, 146 unique, 301.05 QPS, 0.48x concurrency ______
# Time range: 2024-12-08T07:29:32 to 2024-12-08T07:45:03
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           444s     2us   479ms     2ms    12ms     5ms   152us
# Lock time          669ms       0    25ms     2us     1us   123us     1us
# Rows sent        269.57k       0  20.71k    0.98    0.99   39.76    0.99
# Rows examine       6.36M       0  41.42k   23.81    5.75  156.06    0.99
# Query size        27.08M       6 1011.33k  101.32  136.99   2.96k   97.36

# Profile
# Rank Query ID                            Response time  Calls R/Call V/M
# ==== =================================== ============== ===== ====== ===
#    1 0xFFFCA4D67EA0A788813031B8BBC3B329  328.8271 74.1% 30346 0.0108  0.00 COMMIT
#    2 0x172F25C01059578EA9ADF775DD97B517   19.0613  4.3%   351 0.0543  0.02 SELECT ride_statuses rides ride_statuses
#    3 0xD6AD8A431BE7CA447BE67E7F25C2D64A   18.5527  4.2% 23362 0.0008  0.00 SELECT chair_locations
#    4 0xDCA6B16A0FC65C799EB401CBD984EACF    8.2845  1.9% 27299 0.0003  0.00 SELECT ride_statuses
#    5 0xD2D38076E399D482E9094817365408E9    7.6967  1.7% 23362 0.0003  0.00 INSERT chair_locations
#    6 0x49D4717E21912CD8B13961B8248A27CF    7.6835  1.7% 26724 0.0003  0.01 SELECT chairs
#    7 0xD8DAD8AC6EDE2238F17AC39B0009258F    7.3205  1.6% 26214 0.0003  0.00 SELECT rides
#    8 0xE4607CFD429571DE7B78092E46EBE189    7.2882  1.6% 23284 0.0003  0.00 INSERT UPDATE chair_total_distances
#    9 0xE13EB9FE8E585FDE0A4C67FEB1D9D015    6.9102  1.6%  2875 0.0024  0.00 SELECT rides
#   10 0xDF3E6335E6C2FD1DB8C12FD4E3FB9DA3    4.8674  1.1% 23362 0.0002  0.00 SELECT chair_locations
#   11 0xA3B0C1486434871B20F519E77C3FD9E6    4.1223  0.9%  3716 0.0011  0.00 SELECT coupons
#   12 0x9C1BE9A08595D62A208963461F89E6D8    2.1167  0.5%  6516 0.0003  0.00 SELECT ride_statuses
# MISC 0xMISC                               21.1854  4.8% 62870 0.0003   0.0 <134 ITEMS>

# Query 1: 466.86 QPS, 5.06x concurrency, ID 0xFFFCA4D67EA0A788813031B8BBC3B329 at byte 30234888
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         10   30346
# Exec time     74    329s    19us    67ms    11ms    16ms     5ms    11ms
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 177.81k       6       6       6       6       0       6
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #########
# 100us  #
#   1ms  ################
#  10ms  ################################################################
# 100ms
#    1s
#  10s+
COMMIT\G

# Query 2: 1.25 QPS, 0.07x concurrency, ID 0x172F25C01059578EA9ADF775DD97B517 at byte 77140928
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2024-12-08T07:39:10 to 2024-12-08T07:43:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     351
# Exec time      4     19s   833us   166ms    54ms   110ms    35ms    44ms
# Lock time      0   995us     1us   429us     2us     1us    22us     1us
# Rows sent     13  36.49k       0     239  106.46  223.14   66.23   92.72
# Rows examine   7 518.37k      60   2.18k   1.48k   2.06k  700.90   1.69k
# Query size     1 542.52k     920   2.60k   1.55k   2.38k  515.85   1.46k
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ##
#  10ms  ################################################################
# 100ms  #############
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'ride_statuses'\G
#    SHOW CREATE TABLE `isuride`.`ride_statuses`\G
#    SHOW TABLE STATUS FROM `isuride` LIKE 'rides'\G
#    SHOW CREATE TABLE `isuride`.`rides`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT r.chair_id AS chair_id, rs.status AS status FROM ride_statuses rs LEFT JOIN rides r ON rs.ride_id = r.id INNER JOIN (SELECT ride_id, MAX(created_at) AS max_created_at FROM ride_statuses GROUP BY ride_id) latest_rs ON rs.ride_id = latest_rs.ride_id AND rs.created_at = latest_rs.max_created_at WHERE r.chair_id IN ('01JEJKH6V9H1PCYSRDTEH9K9PB', '01JEJKH6VK65S08JPPJ5CVJHJF', '01JEJKH6VYGD2VQ3CY58QEGWNA', '01JEJKH6WAA9GVET9JSNXH07NJ', '01JEJKH6XF09AH2WRPACPFTEY1', '01JEJKH6XSR7TFKA5WN5EGH9TP', '01JEJKH6Y2AD95F7VJMEZA84P6', '01JEJKH6YCJNWNWDC3ADWWYA21', '01JEJKH6ZHXXVGDNGCE2T9EGN5', '01JEJKH6ZTGJDG2JYT7Q8M8RBG', '01JEJKH704VFX43FTG1D731DWH', '01JEJKH70DCAXCD1VCFNJ8W7F1', '01JEJKH71RC60F71PY1RCH7FVX', '01JEJKH722APE5X4HYY9W3F2JD', '01JEJKH72B6B1EJTCAZ0TV0J23', '01JEJKH72PR2FT0AFVA822WZVZ', '01JEJKH73V9E8G7CRJE2ENHMJS', '01JEJKH744A4MA44KRWG81CRMF', '01JEJKH74FGN8PN52WPFTWB25A', '01JEJKH74QB0MQTS37PKG3Q6H2'/*... omitted 51 items ...*/)\G

# Query 3: 389.37 QPS, 0.31x concurrency, ID 0xD6AD8A431BE7CA447BE67E7F25C2D64A at byte 57150229
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   23362
# Exec time      4     19s   111us    28ms   794us     3ms     1ms   348us
# Lock time      7    52ms       0     2ms     2us     1us    33us     1us
# Rows sent      8  22.74k       0       1    1.00    0.99    0.06    0.99
# Rows examine   0  22.74k       0       1    1.00    0.99    0.06    0.99
# Query size     8   2.41M     108     108     108     108       0     108
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ##################
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_locations'\G
#    SHOW CREATE TABLE `isuride`.`chair_locations`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM chair_locations WHERE chair_id = '01JEJKH74QB0MQTS37PKG3Q6H2' ORDER BY created_at DESC LIMIT 1\G

# Query 4: 419.98 QPS, 0.13x concurrency, ID 0xDCA6B16A0FC65C799EB401CBD984EACF at byte 39848926
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   27299
# Exec time      1      8s   103us    13ms   303us   925us   361us   167us
# Lock time      6    43ms       0     2ms     1us     1us    20us     1us
# Rows sent      9  26.66k       1       1       1       1       0       1
# Rows examine   0  26.66k       1       3    1.00    0.99    0.01    0.99
# Query size    10   2.86M     110     110     110     110       0     110
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'ride_statuses'\G
#    SHOW CREATE TABLE `isuride`.`ride_statuses`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT status FROM ride_statuses WHERE ride_id = '01JEJKJ4BG7GPKQJ1Z56NW9RGJ' ORDER BY created_at DESC LIMIT 1\G

# Query 5: 389.37 QPS, 0.13x concurrency, ID 0xD2D38076E399D482E9094817365408E9 at byte 57113703
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   23362
# Exec time      1      8s    81us    23ms   329us     1ms   681us   131us
# Lock time      5    38ms       0     2ms     1us     1us    20us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    11   3.12M     137     141  140.25  136.99       0  136.99
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_locations'\G
#    SHOW CREATE TABLE `isuride`.`chair_locations`\G
INSERT INTO chair_locations (id, chair_id, latitude, longitude) VALUES ('01JEJKJJ76FXE7BNGCMS4WKRM4', '01JEJKJ92KZ8J69ARE5KHDP94E', 344, 297)\G

# Query 6: 411.14 QPS, 0.12x concurrency, ID 0x49D4717E21912CD8B13961B8248A27CF at byte 3908979
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   26724
# Exec time      1      8s    93us    98ms   287us   799us     2ms   138us
# Lock time      7    52ms       0     1ms     1us     1us    17us     1us
# Rows sent      9  26.10k       1       1       1       1       0       1
# Rows examine   0  26.10k       1       1       1       1       0       1
# Query size    10   2.75M     108     108     108     108       0     108
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ##
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chairs'\G
#    SHOW CREATE TABLE `isuride`.`chairs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM chairs WHERE access_token = 'd2bfb82706dafce3614866fe69aadaea6ccdf2eebc015c3b9c332f87505807c8'\G

# Query 7: 403.29 QPS, 0.11x concurrency, ID 0xD8DAD8AC6EDE2238F17AC39B0009258F at byte 66114582
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   26214
# Exec time      1      7s    94us     8ms   279us   881us   321us   152us
# Lock time      6    44ms       0     2ms     1us     1us    20us     1us
# Rows sent      9  25.20k       0       1    0.98    0.99    0.12    0.99
# Rows examine   0  25.20k       0       1    0.98    0.99    0.12    0.99
# Query size     9   2.45M      98      98      98      98       0      98
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ##
#  10ms
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'rides'\G
#    SHOW CREATE TABLE `isuride`.`rides`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM rides WHERE chair_id = '01JEJKH6ZHXXVGDNGCE2T9EGN5' ORDER BY updated_at DESC LIMIT 1\G

# Query 8: 394.64 QPS, 0.12x concurrency, ID 0xE4607CFD429571DE7B78092E46EBE189 at byte 73023398
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:52 to 2024-12-08T07:43:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   23284
# Exec time      1      7s    87us    20ms   313us     1ms   561us   144us
# Lock time      7    50ms       0     2ms     2us     1us    30us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    11   3.18M     143     143     143     143       0     143
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_total_distances'\G
#    SHOW CREATE TABLE `isuride`.`chair_total_distances`\G
INSERT INTO chair_total_distances (chair_id, distance) VALUES ('01JEJKH72PR2FT0AFVA822WZVZ', 2) ON DUPLICATE KEY UPDATE distance = distance + 2\G

# Query 9: 44.23 QPS, 0.11x concurrency, ID 0xE13EB9FE8E585FDE0A4C67FEB1D9D015 at byte 80945752
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    2875
# Exec time      1      7s   491us    17ms     2ms     7ms     2ms     2ms
# Lock time      0     3ms       0   192us     1us     1us     3us     1us
# Rows sent      1   2.81k       1       1       1       1       0       1
# Rows examine  38   2.45M     753     999  892.77  964.41   71.15  874.75
# Query size     0 272.34k      97      97      97      97       0      97
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ##################
#   1ms  ################################################################
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'rides'\G
#    SHOW CREATE TABLE `isuride`.`rides`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM rides WHERE user_id = '01JEJKJTMMH6XE0WZGS5D2XD7X' ORDER BY created_at DESC LIMIT 1\G

# Query 10: 389.37 QPS, 0.08x concurrency, ID 0xDF3E6335E6C2FD1DB8C12FD4E3FB9DA3 at byte 57112270
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   23362
# Exec time      1      5s    58us    24ms   208us   657us   467us    98us
# Lock time      4    32ms       0   676us     1us     1us    12us     1us
# Rows sent      8  22.81k       1       1       1       1       0       1
# Rows examine   0  22.81k       1       1       1       1       0       1
# Query size     5   1.54M      69      69      69      69       0      69
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #####################################################
# 100us  ################################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_locations'\G
#    SHOW CREATE TABLE `isuride`.`chair_locations`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM chair_locations WHERE id = '01JEJKJJ6FCMHSCKMWBGV76545'\G

# Query 11: 57.17 QPS, 0.06x concurrency, ID 0xA3B0C1486434871B20F519E77C3FD9E6 at byte 77009858
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:51 to 2024-12-08T07:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    3716
# Exec time      0      4s   276us    13ms     1ms     3ms     1ms   626us
# Lock time      0     5ms       0   307us     1us     1us     7us     1us
# Rows sent      0   2.14k       0       1    0.59    0.99    0.49    0.99
# Rows examine  34   2.17M     528     673  613.45  652.75   43.27  592.07
# Query size     0 239.51k      66      66      66      66       0      66
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ################################
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'coupons'\G
#    SHOW CREATE TABLE `isuride`.`coupons`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM coupons WHERE used_by = '01JEJKJX36BATQRATFYDWG1AGW'\G

# Query 12: 101.81 QPS, 0.03x concurrency, ID 0x9C1BE9A08595D62A208963461F89E6D8 at byte 33701954
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2024-12-08T07:42:52 to 2024-12-08T07:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6516
# Exec time      0      2s   120us     9ms   324us     1ms   413us   176us
# Lock time      1     7ms       0   294us     1us     1us     4us     1us
# Rows sent     11  31.01k       1       6    4.87    5.75    1.64    5.75
# Rows examine   0  31.01k       1       6    4.87    5.75    1.64    5.75
# Query size     2 585.42k      92      92      92      92       0      92
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ####
#  10ms
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'ride_statuses'\G
#    SHOW CREATE TABLE `isuride`.`ride_statuses`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM ride_statuses WHERE ride_id = '01JEJKHV5JPVN9F4FD4K1HSC1J' ORDER BY created_at\G
