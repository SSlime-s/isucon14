
# 19s user time, 50ms system time, 33.11M rss, 39.41M vsz
# Current date: Sun Dec  8 02:47:22 2024
# Hostname: ip-192-168-0-11
# Files: /var/log/mysql/mysql-slow.log
# Overall: 285.29k total, 123 unique, 275.38 QPS, 0.37x concurrency ______
# Time range: 2024-12-08T02:30:06 to 2024-12-08T02:47:22
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           380s     1us      2s     1ms     2ms    34ms    52us
# Lock time          238ms       0    29ms       0     1us    76us       0
# Rows sent        123.22k       0     538    0.44    0.99    9.46       0
# Rows examine       2.27M       0     833    8.34    0.99   72.20       0
# Query size        16.98M       6 1011.33k   62.42  124.25   2.94k   31.70

# Profile
# Rank Query ID                            Response time  Calls  R/Call V/
# ==== =================================== ============== ====== ====== ==
#    1 0x25D034CF58223D3C0432925663366D80  215.1371 56.6%    146 1.4735  0.07 SELECT chairs chair_locations
#    2 0xFFFCA4D67EA0A788813031B8BBC3B329  125.9027 33.1%  14231 0.0088  0.00 COMMIT
#    3 0xDA556F9115773A1A99AA0165670CE848   11.6254  3.1%  82011 0.0001  0.04 ADMIN PREPARE
#    4 0xDCA6B16A0FC65C799EB401CBD984EACF    3.5315  0.9%  15288 0.0002  0.00 SELECT ride_statuses
#    5 0xE13EB9FE8E585FDE0A4C67FEB1D9D015    3.1345  0.8%   1357 0.0023  0.00 SELECT rides
#    6 0x49D4717E21912CD8B13961B8248A27CF    2.8332  0.7%  12915 0.0002  0.00 SELECT chairs
# MISC 0xMISC                               18.1684  4.8% 159343 0.0001   0.0 <117 ITEMS>

# Query 1: 2.47 QPS, 3.65x concurrency, ID 0x25D034CF58223D3C0432925663366D80 at byte 71807011
# Scores: V/M = 0.07
# Time range: 2024-12-08T02:45:12 to 2024-12-08T02:46:11
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     146
# Exec time     56    215s   163ms      2s      1s      2s   332ms      1s
# Lock time      0   246us     1us     3us     1us     1us       0     1us
# Rows sent      0     735       4     100    5.03    6.98    7.74    3.89
# Rows examine   0   1.42k       8     179    9.92   13.83   13.87    7.70
# Query size     0 132.03k     926     926     926     926       0     926
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms  ######
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chairs'\G
#    SHOW CREATE TABLE `isuride`.`chairs`\G
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chair_locations'\G
#    SHOW CREATE TABLE `isuride`.`chair_locations`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id,
       owner_id,
       name,
       access_token,
       model,
       is_active,
       created_at,
       updated_at,
       IFNULL(total_distance, 0) AS total_distance,
       total_distance_updated_at
FROM chairs
       LEFT JOIN (SELECT chair_id,
                          SUM(IFNULL(distance, 0)) AS total_distance,
                          MAX(created_at)          AS total_distance_updated_at
                   FROM (SELECT chair_id,
                                created_at,
                                ABS(latitude - LAG(latitude) OVER (PARTITION BY chair_id ORDER BY created_at)) +
                                ABS(longitude - LAG(longitude) OVER (PARTITION BY chair_id ORDER BY created_at)) AS distance
                         FROM chair_locations) tmp
                   GROUP BY chair_id) distance_table ON distance_table.chair_id = chairs.id
WHERE owner_id = '01JEJ2G6E8MMBA7X19FE1NVB0Y'\G

# Query 2: 218.94 QPS, 1.94x concurrency, ID 0xFFFCA4D67EA0A788813031B8BBC3B329 at byte 64946614
# Scores: V/M = 0.00
# Time range: 2024-12-08T02:45:12 to 2024-12-08T02:46:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   14231
# Exec time     33    126s    20us    44ms     9ms    14ms     4ms     9ms
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0  83.38k       6       6       6       6       0       6
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #################
# 100us  #
#   1ms  ###################################################
#  10ms  ################################################################
# 100ms
#    1s
#  10s+
COMMIT\G

# Query 3: 1.24k QPS, 0.18x concurrency, ID 0xDA556F9115773A1A99AA0165670CE848 at byte 4084319
# Scores: V/M = 0.04
# Time range: 2024-12-08T02:45:11 to 2024-12-08T02:46:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         28   82011
# Exec time      3     12s    23us   132ms   141us   247us     2ms    54us
# Lock time      0    13us       0     4us       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    13   2.35M      30      30      30      30       0      30
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #######
#   1ms  #
#  10ms  #
# 100ms  #
#    1s
#  10s+
administrator command: Prepare\G

# Query 4: 235.20 QPS, 0.05x concurrency, ID 0xDCA6B16A0FC65C799EB401CBD984EACF at byte 28455818
# Scores: V/M = 0.00
# Time range: 2024-12-08T02:45:12 to 2024-12-08T02:46:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          5   15288
# Exec time      0      4s    89us     4ms   230us   725us   291us   138us
# Lock time      7    19ms       0     2ms     1us     1us    17us     1us
# Rows sent     12  14.93k       1       1       1       1       0       1
# Rows examine   0  14.93k       1       3    1.00    0.99    0.02    0.99
# Query size     9   1.60M     110     110     110     110       0     110
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ##
#  10ms
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'ride_statuses'\G
#    SHOW CREATE TABLE `isuride`.`ride_statuses`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT status FROM ride_statuses WHERE ride_id = '01JEJ2GNQ9E6AHXG7V7QT62WRM' ORDER BY created_at DESC LIMIT 1\G

# Query 5: 21.20 QPS, 0.05x concurrency, ID 0xE13EB9FE8E585FDE0A4C67FEB1D9D015 at byte 71417392
# Scores: V/M = 0.00
# Time range: 2024-12-08T02:45:13 to 2024-12-08T02:46:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1357
# Exec time      0      3s   465us    12ms     2ms     6ms     2ms     2ms
# Lock time      0     2ms       0    57us     1us     1us     2us     1us
# Rows sent      1   1.33k       1       1       1       1       0       1
# Rows examine  45   1.04M     752     833  801.65  793.42   18.14  793.42
# Query size     0 128.54k      97      97      97      97       0      97
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ###############################
#   1ms  ################################################################
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'rides'\G
#    SHOW CREATE TABLE `isuride`.`rides`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM rides WHERE user_id = '01JEJ2HFTYJMCY7QRH71N1RBVT' ORDER BY created_at DESC LIMIT 1\G

# Query 6: 198.69 QPS, 0.04x concurrency, ID 0x49D4717E21912CD8B13961B8248A27CF at byte 4133447
# Scores: V/M = 0.00
# Time range: 2024-12-08T02:45:12 to 2024-12-08T02:46:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   12915
# Exec time      0      3s    78us     7ms   219us   725us   311us   125us
# Lock time     11    29ms       0     3ms     2us     1us    30us     1us
# Rows sent     10  12.61k       1       1       1       1       0       1
# Rows examine   0  12.61k       1       1       1       1       0       1
# Query size     7   1.33M     108     108     108     108       0     108
# String:
# Databases    isuride
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  ##
#  10ms
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isuride` LIKE 'chairs'\G
#    SHOW CREATE TABLE `isuride`.`chairs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM chairs WHERE access_token = '32fb39c7042fe3ed3a533bad9f7645633c419a10c83e3cbc8ff7ef15e792d638'\G
